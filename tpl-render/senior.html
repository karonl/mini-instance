<!DOCTYPE html>
<html>
  <head>
    <title>mini template render</title>
    <meta charset="utf-8">
    <script>
      const TplRender = function(tp, data) {
        data.html = "";
        data.echo = function(block) {
          this.html += block;
        }
        tp = "&>" + tp + "<&";
        const rep = /&>([^&]+)?<&/g;
        let match, ntp = tp; // 原模板
        while(match = rep.exec(tp)) {
          if(match[1]) ntp = ntp.replace(match[0], "echo('" + match[1] + "');");
          else ntp = ntp.replace(match[0], '');
        }
        ntp = ntp.replace(/[\r\n]/g, "");
        data.fn = new Function("", ntp.replace(/echo/g, 'this.echo'));
        data.fn();
        return data.html;
      }
    </script>
  </head>

  <body>
    <div id="main" ></div>
    <script>
      let data = {
        list: [
          {
            test1: "pos机1",
            test2: "图片音像",
            test3: 100,
          },
          {
            test1: "pos机2",
            test2: "游戏娱乐",
            test3: 200,
          }
        ]
      };
      let template = 
        `<& for(let i=0;i<this.list.length;i++){ &>
          <div>
            <p style="margin: 0px">商品名称：<& echo(this.list[i].test1); &></p>
            <p style="margin: 0px">商品分类：<& echo(this.list[i].test2); &></p>
            <p style="margin: 0px">商品价格：<& echo(this.list[i].test3); &></p>
          </div>
        <& } &>`;
      document.getElementById("main").innerHTML = TplRender(template, data);
    </script>
  </body>
</html>
